<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mvvm</title>
  </head>
  <body>
    <div id="app"></div>
  </body>
  <script src="/dist/iife/main.js"></script>
  <script>
    const { effect, reactive, computed, watch } = ZVM;
    console.log(effect);
    const data = reactive({
      a: 1,
      b: {
        c: 4,
      },
      is: true,
    });
    effect(() => {
      console.log(data.is ? data.a : data.b.c);
      effect(() => {
        // 会执行5次，data.is*2、data.a*3
        console.log("嵌套的effect", data.a);
      });
    });

    effect(
      () => {
        console.log(data.a);
      },
      {
        scheduler(effect) {
          Promise.resolve().then(() => {
            console.log("这是scheduler打印的，应该在最后打印：");
            effect();
          });
        },
      }
    );
    cData = computed(() => {
      return data.a + data.b.c;
    });

    watch(
      cData,
      (newValue) => {
        console.log("watch computed：", newValue.value);
      },
      {
        immediate: true,
      }
    );
    console.log(cData);
    watch(
      () => cData.value,
      (newValue) => {
        console.log("watch computed fn：", newValue);
      },
      {
        immediate: true,
      }
    );
    // 虽然数据改变了四次，但是只会执行三次副作用函数
    data.is = false; // 执行
    data.a = 2; // 不执行，因为is===false，不会收集data.a依赖
    data.is = true; // 执行
    data.a = 3; // 执行
    const a = reactive([]);

    effect(() => {
      console.log("遍历开始");
      for (i in a) {
        console.log(a[i]);
      }
      console.log("遍历结束");
    });
    a.push(1);
    a.push(2);
    a.push(3);
    a.push(4);
    a[0] = 2;
    a.length = 2;
  </script>
</html>
