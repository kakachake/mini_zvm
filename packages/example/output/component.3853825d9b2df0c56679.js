(()=>{"use strict";var e={137:(e,t,o)=>{function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}o.d(t,{ri:()=>L});const s=Symbol("raw_key"),r=Symbol("iterate"),i=Symbol("map_key_iterate");var c;let a;!function(e){e[e.SET=0]="SET",e[e.ADD=1]="ADD",e[e.DELETE=2]="DELETE"}(c||(c={}));const p=new WeakMap,d=[];function u(e,t={}){const o=()=>{!function(e){if(e.deps){for(let t=0;t<e.deps.length;t++)e.deps[t].delete(e);e.deps.length=0}}(o),a=o,d.push(o);const t=e();return d.pop(),a=d[d.length-1],t};return o.options=t,o.deps=[],t.lazy||o(),o}function l(e,t){if(!a||!b)return;const o=p.get(e)||p.set(e,new Map).get(e),n=o.get(t)||o.set(t,new Set).get(t);n.add(a),a.deps?a.deps.push(n):(a.deps=[]).push(n)}function m(e,t,{type:o}){const s=p.get(e);if(!s)return;const d=new Set,u=s.get(t),l=s.get(r);if(u&&u.forEach((e=>{d.add(e)})),(o===c.ADD||o===c.DELETE||o===c.SET&&"map"===n(e))&&l&&l.forEach((e=>{e!=a&&d.add(e)})),(o===c.ADD||o===c.DELETE)&&"map"===n(e)){const e=s.get(i);e&&e.forEach((e=>{e!=a&&d.add(e)}))}if(o===c.ADD&&Array.isArray(e)){const e=s.get("length");e&&e.forEach((e=>{e!=a&&d.add(e)}))}d.forEach((e=>{a!==e&&(e.options&&e.options.scheduler?e.options.scheduler(e):e())}))}const h={add(e){const t=this[s],o=t.has(e),n=e[s]||e,r=t.add(n);return o||m(t,e,{type:c.ADD}),r},delete(e){const t=this[s],o=t.has(e),n=t.delete(e);return o&&m(t,e,{type:c.DELETE}),n},get(e){const t=this[s],o=t.has(e);if(l(t,e),o){const o=t.get(e);return"object"==typeof o?y(o):o}},set(e,t){const o=this[s],n=o.has(e),r=o.get(e),i=t[s]||t,a=o.set(e,i);return n?(r!==t||r==r&&t==t)&&m(o,e,{type:c.SET}):m(o,e,{type:c.ADD}),a},forEach(e,t){const o=this[s];return l(o,r),o.forEach(((t,o,n)=>e(f(t),f(o),n)),t)},[Symbol.iterator](){const e=this[s];l(e,r);const t=e[Symbol.iterator]();return{next(){const{value:e,done:o}=t.next();return{value:e?[f(e[0]),f(e[1])]:e,done:o}},[Symbol.iterator](){return this}}},entries(){return this[Symbol.iterator]()},values:function(){const e=this[s],t=e.values();return l(e,r),{next(){const{value:e,done:o}=t.next();return{value:e?f(e):e,done:o}},[Symbol.iterator](){return this}}},keys:function(){const e=this[s],t=e.keys();return l(e,i),{next(){const{value:e,done:o}=t.next();return{value:e?f(e):e,done:o}},[Symbol.iterator](){return this}}}},f=e=>"object"==typeof e?y(e):e,b=!0,g=new Map;function y(e){const t=g.get(e);if(t)return t;const o=function(e,{isShallow:t=!1}){const o=n(e);return new Proxy(e,{get(e,n,i){if("__isProxy__"===n)return!0;if(n===s)return e;if("set"===o||"map"===o)return"size"===n?(l(e,r),Reflect.get(e,n,e)):h[n]?h[n]:e[n].bind(e);"symbol"!=typeof n&&l(e,n);const c=Reflect.get(e,n,i);return t?c:"object"==typeof c&&null!==c?y(c):c},set(e,t,o,n){const s=e[t],r=Array.isArray(e)?Number(t)<e.length?c.SET:c.ADD:Object.prototype.hasOwnProperty.call(e,t)?c.SET:c.ADD,i=Reflect.set(e,t,o,n);return s!==o&&m(e,t,{type:r}),i},has:(e,t)=>(l(e,t),Reflect.has(e,t)),ownKeys:e=>(l(e,Array.isArray(e)?"length":r),Reflect.ownKeys(e)),deleteProperty(e,t){const o=Object.prototype.hasOwnProperty.call(e,t),n=Reflect.deleteProperty(e,t);return o&&n&&(Array.isArray(e)?m(e,t,{type:c.SET}):m(e,t,{type:c.DELETE})),n}})}(e,{});return g.set(e,o),o}function v(e,t,o={immediate:!1}){let n,s,r;function i(e){r=e}function c(){r&&r(),r=null,s=a(),t(s,n,i),n=s}const a=u((()=>"function"==typeof e?e():(console.log(e),E(e))),{lazy:!0,scheduler:()=>{"post"===o.flush?Promise.resolve().then(c):c()}});o.immediate?c():n=a()}function E(e,t=new Set){if("object"!=typeof e||null===e||t.has(e))return e;t.add(e);for(const o in e)E(e[o],t);return e}const w=/^z-/,C=/^z-for/,N=/^z-bind/;function A(e,t,o){const n=t.split("."),s=n.length;let r=0;for(;r<s-1;)e=e[n[r++]];e[n[r]]=o}function $(e,t,o){const n=new Function(t,"return "+function(e,t){t=t.replace(/\s/g,"");const o=/(true|false|null|undefined)/g;return(t=" "+t).replace(/([\(:,\s\+\-\*\/%&\|\^!\*~]\s*?)(([a-zA-Z_$][a-zA-Z_$0-9]*))/g,((t,n,s)=>o.test(s)?n+s:n+e+"."+s))}(t,o));return n(e)}const D={on(e,t,o,n){const s=(o=o.replace(/\s/g,"")).match(/^(\w+)?/);if(!s)return;const r=s[1],i=t.split(":")[1],c=e&&e[r];if(i&&c){const t=e.pubsub?.subscribe(i+n.vm.id,c);n.vm.$emit=(t,...o)=>{e.pubsub?.publish(t.toLowerCase()+n.vm.id,...o)},n.vm._unsubscribes.add(t)}},if(e,t,o,n){let s;v((()=>!!$(e,"scope",o)),(e=>{e?(s=n.createCompApp(),n.mount(s)):n.unmounted(s)}),{immediate:!0})},for(e,t,o,n){const s=(o=o.replace(/\s/g,"")).match(/([(](\w+(,\w+)?)[)]|(\w+))in(\w+)/);if(s){const[,,t,,,o]=s;let r,i=s[1];t&&([i,r]=t.split(","));const c=n.createCompApps(i,r);v((()=>{$(e,"scope",o+".length")}),(()=>{c($(e,"scope",o))}),{immediate:!0})}},bind(e,t,o,{props:n,attrs:s,componentProps:r}){const i=t.split(":"),c=i.length>1?i[1]:t;if(r.hasOwnProperty(c)){const t=$(e,"scope",o);Object(t)instanceof r[c].type?Object.defineProperty(n,c,{enumerable:!0,configurable:!0,get:()=>$(e,"scope",o)}):console.warn(`${c} is not a ${n[c].type.name}`)}else Object.defineProperty(s,c,{enumerable:!0,configurable:!0,get:()=>$(e,"scope",o)})}};class x{componentName;node;parentVm;comment;apps=new Set;attrs=new Map;props={};componentOptions;constructor(e,t){if(this.node=e,this.parentVm=t,this.componentName=e.nodeName.toLowerCase(),this.componentOptions=this.parentVm.$components?.[this.componentName],!this.componentOptions)throw new Error(`component ${this.componentName} not found`);this.initAttrs(),this.initApp()}createCompApp(){const e=L(this.componentOptions);return this.apps.add(e),e}createCompApps(e,t){return o=>{const n=document.createDocumentFragment();let s=0;const r=this.apps.size;this.apps.forEach((e=>{this.unmounted(e,{node:e.node,remove:s!=r-1}),s++})),o.forEach(((o,s)=>{const r=this.createCompApp(),i=k({template:this.comment,data:t?{[e]:o,[t]:s}:{[e]:o}},this.parentVm);r.node=this.mount(r,n,!1,i)})),this.node.parentNode?.replaceChild(n,this.node)}}mount(e,t,o=!0,n){return this.compileDirectives(e,n||this.parentVm),e.vm._runCompile(),e.vm.compile?.mount(t||this.node,o)}unmounted(e,t){e&&(e.destroy&&e.destroy(),this.apps.delete(e),t?.node?t.remove?t.node.parentNode?.removeChild(t.node):t.node.parentNode?.replaceChild(this.node,t.node):(this.node.parentNode?.replaceChild(this.comment,this.node),this.node=this.comment))}initApp(){if(this.attrs.get("z-if"))this.comment=document.createComment("z-if"),this.node.parentNode?.replaceChild(this.comment,this.node),this.node=this.comment,D.if(this.parentVm,"if",this.attrs.get("z-if")||"",this),this.attrs.delete("z-if");else if(this.attrs.get("z-for"))this.comment=document.createComment("z-for"),this.node.parentNode?.replaceChild(this.comment,this.node),this.node=this.comment,D.for(this.parentVm,"for",this.attrs.get("z-for")||"",this),this.attrs.delete("z-for");else{const e=this.createCompApp();this.mount(e)}}initAttrs(){Array.from(this.node.attributes).forEach((e=>{const t=e.nodeName,o=e.nodeValue||"";this.attrs.set(t,o)}))}compileDirectives(e,t){const o=e.vm.$props,n=e.vm.$attrs,s=e.vm.$options.props;this.attrs.forEach(((r,i)=>{if(N.test(i))D.bind(t,i,r,{props:o||{},attrs:n||{},componentProps:s||{}});else if(w.test(i)){const t=i,o=r;!function(e,t,o,n){const{name:s,arg:r}=function(e){const t=e.match(/^z-(\w+)\s*(:(\w*))?$/);return t?{name:t[1],arg:t[3]}:{}}(t);s&&r&&D[s]&&D[s](e,t,o,n)}(this.parentVm,t,o,e)}else e.vm.$attrs[i]=r}))}}const O={textRender:(e,t,o)=>{if("INPUT"===e.nodeName){const o=e.getAttribute("type");if("radio"===o){const o=e.value;return void(e.checked=t===o)}return"checkbox"===o?void(e.checked=!!t):void(e.value=t)}Object.hasOwn(e,"_textContent")||Object.defineProperty(e,"_textContent",{value:e.textContent});const n=e._textContent;e.textContent=o?n.replace(o,t)||"":void 0===t?"":t},classRender:(e,t)=>{for(const o in t)t[o]?e.classList.add(o):e.classList.remove(o)},attrRender:e=>(t,o)=>{!0===o?t.setAttribute(e,""):!1===o?t.removeAttribute(e):t.setAttribute(e,o)},forRender:e=>{const t=e.cloneNode(!0),o=e.parentNode,n=e.previousSibling,s=[];return o?.removeChild(e),(e,r,i,c)=>{s.forEach((e=>{o?.removeChild(e)})),s.length=0;let a=n;for(let n=0;n<i.length;n++){if(!i[n])continue;const u=t.cloneNode(!0);u.removeAttribute("z-for"),a?(p=u,(d=a)?.parentNode?.insertBefore(p,d.nextSibling)):o?.appendChild(u),a=u,s.push(u);const l=k({template:u,data:r?{[e]:i[n],[r]:n}:{[e]:i[n]}},c);new z(u,l,{compileRoot:!0}).mount(),a=u}var p,d}}},S={};function T(e,t){S[e.toLowerCase()]=t}const j={on(e,t,o,n){const s=(n=n.replace(/\s/g,"")).match(/^(\w+)([(]((,?[$'\w']+)+)[)])?/);if(!s)return;const r=s[1],i=[],c=/^'(.*)'$/,a=/(\$event)$/;let p=-1;s&&s[3]&&s[3].split(",").forEach((e=>{c.test(e)?i.push(e.replace(c,"$1")):a.test(e)?(i.push(e),p=i.length-1):i.push(function(e,t){const o=t.split("."),n=o.length;let s=0;for(;s<n;)e=e[o[s++]];return e}(t.$data,e))}));const d=o.split(":")[1],u=t&&t[r];d&&u&&e.addEventListener(d,(e=>(~p&&i.splice(p,1,e),i.length||i.push(e),u.call(t,...i))))},model(e,t,o,n){this.text(e,t,o,n),("INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName)&&e.addEventListener("input",(e=>{A(t.$data,n,e.target.value),e.preventDefault()})),"INPUT"===e.tagName&&"checkbox"===e.type&&e.addEventListener("change",(e=>{A(t.$data,n,e.target.checked)})),"INPUT"===e.tagName&&"radio"===e.type&&e.addEventListener("change",(e=>{A(t.$data,n,e.target.value)}))},text(e,t,o,n,s=""){const r=O.textRender;r&&v((()=>$(t,"scope",n)),(t=>{r&&r(e,t,s)}),{immediate:!0})},if(e,t,o,n){const s=e.nextElementSibling;let r=null;s&&void 0!==s.getAttribute("z-else")&&(r=s),v((()=>!!$(t,"scope",n)),(t=>{t?(e.style.display="block",r&&(r.style.display="none")):(e.style.display="none",r&&(r.style.display="block"))}),{immediate:!0})},for(e,t,o,n){const s=(n=n.replace(/\s/g,"")).match(/([(](\w+(,\w+)?)[)]|(\w+))in(\w+)/);if(s){const[,,o,,,n]=s;let r,i=s[1];o&&([i,r]=o.split(","));const c=O.forRender(e);u((()=>{c(i,r,$(t,"scope",n),t)}))}},bind(e,t,o,n){const s=o.split(":"),r=s.length>1?s[1]:o;let i=O[r+"Render"];i||(i=O.attrRender(r)),i&&u((()=>{i(e,$(t,"scope",n))}))}};class z{node;vm;needDeepCompile=!0;frag;options;mountType;mountNode;parentNode;constructor(e,t,o={compileRoot:!1}){this.vm=t,this.options=o,this.frag=this.nodeToFragment(e),this.mountNode=e,this.node=this.frag.children[0],o.compileRoot&&this.compileNode(e,this.vm),this.compileFrag(this.frag,this.vm)}mount(e,t){return e&&"boolean"!=typeof e?("string"==typeof e&&(e=document.querySelector(e)||""),"string"!=typeof e?(e&&t?(this.parentNode=e.parentNode,this.parentNode?.replaceChild(this.frag,e)):e&&e.appendChild(this.frag),this.mountNode=e,this.mountType=t?"replace":"append",this.vm.pubsub?.publish("mounted"),this.node):void 0):(this.mountNode.appendChild(this.frag),this.vm.pubsub?.publish("mounted"),this.frag)}unmounted(){try{"append"===this.mountType?this.mountNode?.removeChild(this.node):(console.log(this.node),this.parentNode?.replaceChild(this.mountNode,this.node)),this.vm.pubsub?.publish("unmounted")}catch(e){}}removeChilds(e){for(;e.firstChild;)e.firstChild.childNodes.length&&this.removeChilds(e.firstChild),e.removeChild(e.firstChild)}getFragment(){return this.frag}nodeToFragment(e){const t=document.createDocumentFragment();let o;for(;o=e.firstChild;)t.appendChild(o);return t}compileFrag(e,t){const o=e.childNodes;Array.from(o).forEach((e=>{this.compileNode(e,t),e.childNodes&&e.childNodes.length&&this.needDeepCompile&&this.compileFrag(e,t),this.needDeepCompile=!0}))}compileNode(e,t){t.$components&&t.$components[e.nodeName.toLowerCase()]?new x(e,t):1===e.nodeType?this.compileElement(e,t):3===e.nodeType&&this.compileText(e,t)}compileText(e,t){const o=e.textContent;if(!o)return;const n=/\{\{(.*)\}\}/.exec(o);null!==n&&j.text(e,t,"text",n[1],n[0])}compileElement(e,t){const o=Array.from(e.attributes),n=o.findIndex((e=>C.test(e.nodeName)));if(~n)return this.needDeepCompile=!1,void this.compileDirective(e,t,o[n]);Array.from(e.attributes).forEach((o=>{this.compileDirective(e,t,o)}))}compileDirective(e,t,o){const n=o.nodeName,s=o.nodeValue||"";w.test(n)&&(function(e,t,o,n){const{name:s,arg:r}=function(e){const t=e.match(/^z-(\w+)\s*(:(\w*))?$/);return t?{name:t[1],arg:t[3]}:{}}(o);s&&(j[s]?j[s](e,t,o,n):S[s]&&t.pubsub?.subscribe("mounted",(()=>{v((()=>$(t,"scope",n)),(t=>{S[s](e,{arg:r,value:t})}),{immediate:!0})})))}(e,t,n,s),e.removeAttribute(n))}}class P{subscribers;constructor(){this.subscribers={}}subscribe(e,t){return this.subscribers[e]||(this.subscribers[e]=new Set),this.subscribers[e].add(t),()=>{this.undsubscribe(e,t)}}publish(e,t=""){this.subscribers[e]&&this.subscribers[e].forEach((e=>{e(t)}))}undsubscribe(e,t){this.subscribers[e]&&this.subscribers[e].delete(t)}}function k(e,t={},o=!0){const n=Object.create(t);if(n.id=Math.random().toString(36).substr(2),!e.template&&!e.render)throw new Error("template or render not found");var s,r;return e.template?n.$el="string"==typeof e.template?document.querySelector(e.template):e.template:e.render&&(n.$el=e.render.call(n,R)),e.props&&(n.$props={},s=n,r=e.props,Object.keys(r).forEach((e=>{r.hasOwnProperty(e)&&Object.defineProperty(s,e,{configurable:!0,enumerable:!0,get:()=>s.$props[e]||r[e].default})}))),e.data&&(n.$data="function"==typeof e.data?o?y(e.data()):e.data():o?y(e.data):e.data,function(e){Object.keys(e.$data).forEach((t=>{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:()=>e.$data[t],set:o=>{e.$data[t]=o}})}))}(n)),e.components&&Object.keys(e.components).map((t=>{n.$components={...n.$components,[t.toLowerCase()]:e.components[t]}})),n.$options=e,n.pubsub=new P,n._unsubscribes=new Set,function(e,t){t.created&&e.pubsub?.subscribe("created",t.created.bind(e)),t.mounted&&e.pubsub?.subscribe("mounted",t.mounted.bind(e))}(n,e),e.methods&&Object.keys(e.methods).forEach((e=>{!function(e,t){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:()=>e.$options?.methods?.[t].bind(e)})}(n,e)})),e.computed&&function(e,t){"object"==typeof t&&Object.keys(t).forEach((o=>{const n=function(e){let t,o=!0;const n=u(e,{lazy:!0,scheduler(){o||(o=!0,m(s,"value",{type:c.SET}))}}),s={get value(){return o&&(t=n(),o=!1),l(s,"value"),t}};return s}(t[o].bind(e));Object.defineProperty(e,o,{get:()=>n.value})}))}(n,e.computed),e.directives&&function(e,t){"object"==typeof t&&Object.keys(t).forEach((e=>{T(e,t[e])}))}(0,e.directives),n}function L(e){const t=k(e);t.pubsub?.publish("created"),t._runCompile=e=>{t.compile=new z(t.$el,t,e)};const o=function(e){return(t,o)=>{e.$components={...e.$components,[t.toLowerCase()]:o}}}(t);return{vm:t,mount:e=>{t._runCompile(),t.compile.mount(e)},directive:T,destroy:()=>{t.compile?.unmounted(),t._unsubscribes.forEach((e=>{e()}))},component:o}}function R(e){const t=document.createElement("div");return t.innerHTML=e,t}console.log("zvm 0.1.0")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=(0,o(137).ri)({template:"#app",data:()=>({show:!1,count:0,items:[{msg:"111"},{msg:"222"},{msg:"333"}]}),methods:{add(){this.count++,console.log(this.count)},toggle(){this.show=!this.show,console.log(this.show)},addItem(){console.log("addItem"),this.items.push({msg:"444"}),console.log(this.items)}}});e.component("button-counter",{props:{propcount:{type:Number,default:0},item:{type:Object,default:{msg:456}}},data:()=>({count:0}),created(){this.count=this.propcount},methods:{add(){this.count++,this.$emit("addCount")}},render:e=>e('\n    <div>\n      <button z-on:click="add" >\n        You clicked me {{ count }} times.\n      </button>\n      <div>{{item.msg}}</div>\n      {{propcount}}\n    </div>\n    ')}),e.mount("#app")})()})();